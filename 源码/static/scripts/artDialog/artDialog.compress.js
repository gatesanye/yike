/* artDialog 5 | (c) 2009-2012 TangBin | http://code.google.com/p/artdialog/ */(function(a,b,c){if("BackCompat"===document.compatMode)throw Error("artDialog: Document types require more than xhtml1.0");var d,e=0,f="artDialog"+ +(new Date),g=b.VBArray&&!b.XMLHttpRequest,h="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),i=!g&&!h,j=function(a,b,g){a=a||{};if("string"==typeof a||1===a.nodeType)a={content:a,fixed:!h};var k;k=j.defaults;var o=a.follow=1===this.nodeType&&this||a.follow,r;for(r in k)a[r]===c&&(a[r]=k[r]);a.id=o&&o[f+"follow"]||a.id||f+e;if(k=j.list[a.id])return o&&k.follow(o),k.zIndex().focus(),k;i||(a.fixed=!1);if(!a.button||!a.button.push)a.button=[];return b!==c&&(a.ok=b),a.ok&&a.button.push({id:"ok",value:a.okValue,callback:a.ok,focus:!0}),g!==c&&(a.cancel=g),a.cancel&&a.button.push({id:"cancel",value:a.cancelValue,callback:a.cancel}),j.defaults.zIndex=a.zIndex,e++,j.list[a.id]=d?d.constructor(a):new j.fn.constructor(a)};j.version="5.0",j.fn=j.prototype={constructor:function(a){var b;return this.closed=!1,this.config=a,this.dom=b=this.dom||this._getDom(),a.skin&&b.wrap.addClass(a.skin),b.wrap.css("position",a.fixed?"fixed":"absolute"),b.close[!1===a.cancel?"hide":"show"](),b.content.css("padding",a.padding),this.button.apply(this,a.button),this.title(a.title).content(a.content).size(a.width,a.height).time(a.time),a.follow?this.follow(a.follow):this.position(),this.zIndex(),a.lock&&this.lock(),this._addEvent(),this[a.visible?"visible":"hidden"]().focus(),d=null,a.initialize&&a.initialize.call(this),this},content:function(b){var c,d,e,f,g=this,h=this.dom.content,i=h[0];return this._elemBack&&(this._elemBack(),delete this._elemBack),"string"==typeof b?h.html(b):b&&1===b.nodeType&&(f=b.style.display,c=b.previousSibling,d=b.nextSibling,e=b.parentNode,this._elemBack=function(){c&&c.parentNode?c.parentNode.insertBefore(b,c.nextSibling):d&&d.parentNode?d.parentNode.insertBefore(b,d):e&&e.appendChild(b),b.style.display=f,g._elemBack=null},h.html(""),i.appendChild(b),a(b).show()),this.position()},title:function(a){var b=this.dom,c=b.outer,b=b.title;return!1===a?(b.hide().html(""),c.addClass("d-state-noTitle")):(b.show().html(a),c.removeClass("d-state-noTitle")),this},position:function(){var a=this.dom,b=a.wrap[0],c=a.window,d=a.document,e=this.config.fixed,a=e?0:d.scrollLeft(),d=e?0:d.scrollTop(),e=c.width(),f=c.height(),g=b.offsetHeight,c=(e-b.offsetWidth)/2+a,e=e=(g<4*f/7?.382*f-g/2:(f-g)/2)+d,b=b.style;return b.left=Math.max(c,a)+"px",b.top=Math.max(e,d)+"px",this},size:function(a,b){var c=this.dom.main[0].style;return"number"==typeof a&&(a+="px"),"number"==typeof b&&(b+="px"),c.width=a,c.height=b,this},follow:function(b){var c=a(b),d=this.config;if(!b||!b.offsetWidth&&!b.offsetHeight)return this.position(this._left,this._top);var e=d.fixed,g=f+"follow",h=this.dom,i=h.window,j=h.document,h=i.width(),i=i.height(),k=j.scrollLeft(),j=j.scrollTop(),l=c.offset(),c=b.offsetWidth,m=e?l.left-k:l.left,l=e?l.top-j:l.top,n=this.dom.wrap[0],o=n.style,q=n.offsetWidth,n=n.offsetHeight,r=m-(q-c)/2,s=l+b.offsetHeight,k=e?0:k,e=e?0:j;return o.left=(r<k?m:r+q>h&&m-q>k?m-q+c:r)+"px",o.top=(s+n>i+e&&l-n>e?l-n:s)+"px",this._follow&&this._follow.removeAttribute(g),this._follow=b,b[g]=d.id,this},button:function(){for(var b=this.dom.buttons,c=b[0],d=this._listeners=this._listeners||{},e=[].slice.call(arguments),g=0,h,i,j,k,l;g<e.length;g++)h=e[g],i=h.value,j=h.id||i,k=!d[j],l=k?document.createElement("input"):d[j].elem,l.type="button",l.className="d-button",d[j]||(d[j]={}),i&&(l.value=i),h.width&&(l.style.width=h.width),h.callback&&(d[j].callback=h.callback),h.focus&&(this._focus&&this._focus.removeClass("d-state-highlight"),this._focus=a(l).addClass("d-state-highlight"),this.focus()),l[f+"callback"]=j,l.disabled=!!h.disabled,k&&(d[j].elem=l,c.appendChild(l));return b[0].style.display=e.length?"":"none",this},visible:function(){return this.dom.wrap.css("visibility","visible"),this.dom.outer.addClass("d-state-visible"),this._isLock&&this._lockMask.show(),this},hidden:function(){return this.dom.wrap.css("visibility","hidden"),this.dom.outer.removeClass("d-state-visible"),this._isLock&&this._lockMask.hide(),this},close:function(){if(this.closed)return this;var a=this.dom,b=a.wrap,c=j.list,e=this.config.beforeunload,g=this.config.follow;if(e&&!1===e.call(this))return this;j.focus===this&&(j.focus=null),g&&g.removeAttribute(f+"follow"),this._elemBack&&this._elemBack(),this.time(),this.unlock(),this._removeEvent(),delete c[this.config.id];if(d)b.remove();else{d=this,a.title.html(""),a.content.html(""),a.buttons.html(""),b[0].className=b[0].style.cssText="",a.outer[0].className="d-outer",b.css({left:0,top:0,position:i?"fixed":"absolute"});for(var h in this)this.hasOwnProperty(h)&&"dom"!==h&&delete this[h];this.hidden()}return this.closed=!0,this},time:function(a){var b=this,c=this._timer;return c&&clearTimeout(c),a&&(this._timer=setTimeout(function(){b._click("cancel")},a)),this},focus:function(){if(this.config.focus)try{var a=this._focus&&this._focus[0]||this.dom.close[0];a&&a.focus()}catch(b){}return this},zIndex:function(){var a=this.dom,b=j.focus,c=j.defaults.zIndex++;return a.wrap.css("zIndex",c),this._lockMask&&this._lockMask.css("zIndex",c-1),b&&b.dom.outer.removeClass("d-state-focus"),j.focus=this,a.outer.addClass("d-state-focus"),this},lock:function(){if(this._isLock)return this;var c=this,d=this.dom,e=document.createElement("div"),f=a(e),g=j.defaults.zIndex-1;return this.zIndex(),d.outer.addClass("d-state-lock"),f.css({zIndex:g,position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden"}).addClass("d-mask"),i||f.css({position:"absolute",width:a(b).width()+"px",height:a(document).height()+"px"}),f.bind("click",function(){c._reset()}).bind("dblclick",function(){c._click("cancel")}),document.body.appendChild(e),this._lockMask=f,this._isLock=!0,this},unlock:function(){return this._isLock?(this._lockMask.unbind(),this._lockMask.hide(),this._lockMask.remove(),this.dom.outer.removeClass("d-state-lock"),this._isLock=!1,this):this},_getDom:function(){var c=document.body;if(!c)throw Error('artDialog: "documents.body" not ready');var d=document.createElement("div");d.style.cssText="position:absolute;left:0;top:0",d.innerHTML=j._templates,c.insertBefore(d,c.firstChild);for(var e=0,f={},g=d.getElementsByTagName("*"),h=g.length;e<h;e++)(c=g[e].className.split("d-")[1])&&(f[c]=a(g[e]));return f.window=a(b),f.document=a(document),f.wrap=a(d),f},_click:function(a){return a=this._listeners[a]&&this._listeners[a].callback,"function"!=typeof a||!1!==a.call(this)?this.close():this},_reset:function(){var a=this.config.follow;a?this.follow(a):this.position()},_addEvent:function(){var a=this,b=this.dom;b.wrap.bind("click",function(c){c=c.target;if(c.disabled)return!1;if(c===b.close[0])return a._click("cancel"),!1;(c=c[f+"callback"])&&a._click(c)}).bind("mousedown",function(){a.zIndex()})},_removeEvent:function(){this.dom.wrap.unbind()}},j.fn.constructor.prototype=j.fn,a.fn.dialog=a.fn.artDialog=function(){var a=arguments;return this[this.live?"live":"bind"]("click",function(){return j.apply(this,a),!1}),this},j.focus=null,j.get=function(a){return a===c?j.list:j.list[a]},j.list={},a(document).bind("keydown",function(a){var b=a.target,c=b.nodeName,d=/^input|textarea$/i,e=j.focus,a=a.keyCode;e&&e.config.esc&&(!d.test(c)||"button"===b.type)&&27===a&&e._click("cancel")}),a(b).bind("resize",function(){var a=j.list,b;for(b in a)a[b]._reset()}),j._templates='<div class="d-outer"><table class="d-border"><tbody><tr><td class="d-nw"></td><td class="d-n"></td><td class="d-ne"></td></tr><tr><td class="d-w"></td><td class="d-c"><div class="d-inner"><table class="d-dialog"><tbody><tr><td class="d-header"><div class="d-titleBar"><div class="d-title"></div><a class="d-close" href="javascript:/*artDialog*/;">\u00d7</a></div></td></tr><tr><td class="d-main"><div class="d-content"></div></td></tr><tr><td class="d-footer"><div class="d-buttons"></div></td></tr></tbody></table></div></td><td class="d-e"></td></tr><tr><td class="d-sw"></td><td class="d-s"></td><td class="d-se"></td></tr></tbody></table></div>',j.defaults={content:'<div class="d-loading"><span>loading..</span></div>',title:"message",button:null,ok:null,cancel:null,initialize:null,beforeunload:null,okValue:"ok",cancelValue:"cancel",width:"auto",height:"auto",padding:"20px 25px",skin:null,time:null,esc:!0,focus:!0,visible:!0,follow:null,lock:!1,fixed:!1,zIndex:1987},this.artDialog=a.dialog=a.artDialog=j})(this.art||this.jQuery,this),function(a){a.alert=a.dialog.alert=function(b,c){return a.dialog({id:"Alert",fixed:!0,lock:!0,content:b,ok:!0,beforeunload:c})},a.confirm=a.dialog.confirm=function(b,c,d){return a.dialog({id:"Confirm",fixed:!0,lock:!0,content:b,ok:c,cancel:d})},a.prompt=a.dialog.prompt=function(b,c,d){d=d||"";var e;return a.dialog({id:"Prompt",fixed:!0,lock:!0,content:['<div style="margin-bottom:5px;font-size:12px">',b,"</div>","<div>",'<input type="text" class="d-input-text" value="',d,'" style="width:18em;padding:6px 4px" />',"</div>"].join(""),initialize:function(){e=this.dom.content.find(".d-input-text")[0],e.select(),e.focus()},ok:function(){return c&&c.call(this,e.value)},cancel:function(){}})},a.dialog.prototype.shake=function(){var a=function(a,b,c){var d=+(new Date),e=setInterval(function(){var f=+(new Date)-d,g=f/c;g>=1?(clearInterval(e),b(g)):a(g)},13)},b=function(c,d,e){var f=arguments[3];f===undefined&&(f=6,e/=f);var g=c.style,h=parseInt(g.marginLeft)||0;a(function(a){c.style.marginLeft=h+(d-h)*a+"px"},function(){f!==0&&b(c,f===1?0:(d/f-d)*1.3,e,--f)},e)};return function(){return b(this.dom.wrap[0],40,600),this}}();var b=function(){var a=this,b=function(b){var c=a[b];a[b]=function(){return c.apply(a,arguments)}};b("start"),b("over"),b("end")};b.prototype={start:function(b){return a(document).bind("mousemove",this.over).bind("mouseup",this.end),this._sClientX=b.clientX,this._sClientY=b.clientY,this.onstart(b.clientX,b.clientY),!1},over:function(a){return this._mClientX=a.clientX,this._mClientY=a.clientY,this.onover(a.clientX-this._sClientX,a.clientY-this._sClientY),!1},end:function(b){return a(document).unbind("mousemove",this.over).unbind("mouseup",this.end),this.onend(b.clientX,b.clientY),!1}};var c=a(window),d=a(document),e=document.documentElement,f=!("minWidth"in e.style),g=!f&&"onlosecapture"in e,h="setCapture"in e,i=function(){return!1},j=function(a){var e=new b,f=artDialog.focus,j=f.dom,k=j.wrap,l=j.title,m=j.main,n=k[0],o=l[0],p=m[0],q=n.style,r=p.style,s=a.target===j.se[0]?!0:!1,t=n.style.position==="fixed",u=t?0:d.scrollLeft(),v=t?0:d.scrollTop(),w=c.width()-n.offsetWidth+u,x=c.height()-n.offsetHeight+v,y,z,A,B;e.onstart=function(a,b){s?(y=p.offsetWidth,z=p.offsetHeight):(A=n.offsetLeft,B=n.offsetTop),d.bind("dblclick",e.end).bind("dragstart",i),g?l.bind("losecapture",e.end):c.bind("blur",e.end),h&&o.setCapture(),k.addClass("d-state-drag"),f.focus()},e.onover=function(a,b){if(s){var c=a+y,d=b+z;q.width="auto",r.width=Math.max(0,c)+"px",q.width=n.offsetWidth+"px",r.height=Math.max(0,d)+"px"}else{var e=Math.max(u,Math.min(w,a+A)),f=Math.max(v,Math.min(x,b+B));q.left=e+"px",q.top=f+"px"}},e.onend=function(a,b){d.unbind("dblclick",e.end).unbind("dragstart",i),g?l.unbind("losecapture",e.end):c.unbind("blur",e.end),h&&o.releaseCapture(),k.removeClass("d-state-drag")},e.start(a)};a(document).bind("mousedown",function(a){var b=artDialog.focus;if(!b)return;var c=a.target,d=b.config,e=b.dom;if(d.drag!==!1&&c===e.title[0]||d.resize!==!1&&c===e.se[0])return j(a),!1})}(this.art||this.jQuery)